Synthetic biology is being used for therapeutic production either to develop cell factories using industrial microorganisms  or to synthesize genetic circuits allowing therapeutic delivery . Recombinant DNA technology has already provided the ability to genetically engineer cell strains in order to import pathways from other organisms capable of producing small molecule chemicals into microbial chassis. Moreover, to estimate the efficiency of the overall process, metabolic engineering-based tools consider models of cell metabolism as a whole, allowing the identification and redesign of bottlenecks in the biosynthetic pathways. Therefore, the next challenge ahead remains the integration of all these design steps into a flexible and automated biosynthetic manufacturing pipeline of molecules. In recent years, many successful examples of bioproduction of chemicals with therapeutic interest through metabolic engineering have been reported. Among others, plant secondary metabolites that are of medicinal value, such as the terpenoids artemisinic acid  and paclitaxel (taxol) , benzylisoquinoline alkaloids , and flavonoids  have been successfully produced by metabolically engineered microorganisms. Similarly, heterologous production of therapeutically important antibiotics such as aminoglycosides derivatives, which include ribostamycin , neomycin, gentamicin and kanamycin, as well as other natural products like polyketides  and nonribosomal peptides  have been reported. Flexible production of novel antibiotics is of special interest in order to fight against the increasing emergence of multidrug-resistant pathogens [-]. In an attempt to rationalize the biosynthetic design process, metabolic engineering models the metabolic network of the cell as a whole . A suitable topological representation of the metabolic network can be achieved by using directed hypergraphs  where catalytic reactions are hyperedges connecting node substrates to products. Moreover, genome-wide reconstructions of an organism's metabolism with explicit reference to the stoichiometry of the reactions can be studied in order to estimate steady-state fluxes . Sensitivity analysis of fluxes provides a systematic way to determine production bottlenecks, where gene overexpression or repression might enhance production for the target compound . In addition, stochastic and deterministic system dynamics methods are used to simulate enzymatic reaction kinetics . Through metabolic modeling, the repertoire of biochemical transformations in biosynthetic pathways are extended beyond what is present in metabolic databases like KEGG  and MetaCyc . methods for pathway prediction and optimization are mainly based on two approaches: homologies of chemical structure transformation patterns [-], and knowledge-based expert systems . Retrosynthesis algorithms  perform a backward search for biosynthetic routes leading from a target compound to the host metabolites through iterative application of a defined set of biochemical transformation rules. One approach is BNICE , where molecules and reactions are represented by bond-electron matrices (BEM) . BEM entries correspond to the covalent bond order between atoms, whereas the Dugundji-Ugi model for a metabolic reaction is implemented through the matrix difference between the BEM of products and substrates. With BNICE, reactions in the KEGG database  are represented through approximately 250 unique elementary transformations, which approximately correspond to the classification at the 3rd EC digits . In the same fashion, the molecular signature descriptor  is an algorithm that returns for a given target compound fourth and third EC digits, respectively, of predicted enzymes capable of producing the structure. Similarly, other retrosynthetic framework has been proposed based on 50 reaction rules . A retrosynthetic search in the metabolic hypergraph might lead to a combinatorial explosion. For instance, using only 50 reaction rules, 100,000 reaction routes were predicted for the production of isobutanol , far more than what could be realistically tested in the laboratory. Thus, in order to find a trade-off between the inherent complexity of pathway design and the use of experimental information, we present here a tool based on the coding of compounds and reactions through molecular signatures . The molecular signature is a canonical representation of the subgraph surrounding a particular atom in a molecular structure up to a predefined diameter or height . A metabolic reaction signature is given by the difference between the signatures of products and substrates . As further described in the Methods section, the signature coding system can be made more or less specific to compounds and reactions by selecting the height, low heights are less specific (as molecular signatures become more and more ambiguous) and high heights are specific (as molecular signatures become more and more precise), thus the numbers of reactions and consequently pathways can be controlled. Once metabolic models for the heterologous biosynthesis of target compounds have been determined, individual performances for the predicted pathways need to be characterized in order to prioritize the engineering of the most promising routes into the chassis organism. Several computational frameworks have proposed different factors that might influence the performance of an engineered strain. PathMiner introduced a path cost associated with the number of heterologous enzymes measured through a chemical distance . BNICE applied the group contribution method  for reactants and products in order to rank pathways based on the thermodynamic favorability . Other aspects influencing the pathway performance are pathway length, organism specificity , heterologous expression, growth rate, and precursor supply . In addition, many other factors might be considered, for instance, PathoLogic defined 123 pathway features that may be relevant to the pathway ranking problem . Therefore, subsequent optimization of the heterologous engineered strain through genetic, metabolic and enzyme design approaches would be usually necessary in order to attain the desired final yields in the production of the target compound. Moreover, increasing efficiency levels for rate-limiting enzymatic reactions involved in the pathway is an additional strategy for the rational design of industrial strains [,,]. We present here a unified framework that combines several techniques involved in the design of heterologous biosynthetic pathways through a retrosynthetic approach in the reaction signature space, enabling the flexible design of industrial microorganisms for the efficient on-demand production of chemical compounds of interest. The extended metabolic reaction space (EMRS) Our method starts by mapping the metabolic network into the signature space in order to build an extended representation of the metabolic reaction space (see definitions in Methods). Molecular signatures, which are a representation of the molecular graph, can be used in order to code reactions . This process is illustrated in Figure . Canonical molecular signatures identify unique compounds when they are computed at the height of the maximum diameter of the molecular graph, whereas signatures at lower height provide a way to search for and enumerate similar chemical compounds. Likewise, reaction signatures, which are biochemical reactions coded into the molecular signature representation (Equation 7 in Methods), are used in order to search for and enumerate similar reactions. We define the extended metabolic reaction space (EMRS) as the set of all possible reactions that can be generated from signatures contained in the metabolic network. Therefore, the EMRS consists of both reactions in the metabolic network and additional putative reactions, which are assumed to be promiscuously catalyzed by enzymes present in the organism. Given a finite height , novel reactions are discovered through this method by performing a search in the metabolite signature space of combinations of stoichiometric coefficients of metabolites having the same signature as either the substrates or the products. Figure  shows the metabolic reaction map of the 966 endogenous metabolites in (Figure ) and of the additional 2338 compounds that are reachable from after the generation of the EMRS (Figure ). An illustrative example is the metabolite signature space of height = 0. In this space, compounds are represented by their elemental formula. Similarly, the combination of the substrates and products in the reaction are represented by their total molecular formula. Thus, any combination of compounds satisfying the elemental formula is considered a putative set of reactants. In order to compute the EMRS of height = 0, we need to solve Diophantine equations in the signature space of height = 0 that generally lead to a set of solutions too large to be of use. In the case of = 1, the number of newly created reactions is still significantly large (for a network like the one shown in Figure , it would be above 10). This number, nevertheless, becomes tractable once we consider heights higher than = 2, which corresponds to a 17.72% increase in the number of reactions with respect to nominal reactions, as it is shown in Table . Starting from the list of coded reactions, the iterative backward application of the biochemical transformations to compounds of interest allows the identification of enzymatic routes linking the desired compound to precursors that are endogenous to the chassis organism. Each of these routes constitutes an exogenous biosynthetic pathway for that compound. In the next sections, we present an approach for ranking the biosynthetic pathways of a given compound in order to select the best pathways to engineer in the chassis organism. The atomic, molecular and reaction signature coding . A) The process for computing the molecular signature for a compound is illustrated for 6-aminohexanate. The process starts by computing the atomic signature for each atom. In the given example, the atomic signature for the carbon in the carboxylic group is computed up to height = 2. At height = 0 (blue), the molecular graph rooted at the atom is given by the atom itself; at height = 1 (green) a canonical representation of the root atom and its first atomic neighbors are given; the process continues similarly for heights = 2 (orange) and higher until the diameter of the graph is reached. Atomic signatures are collected for all atoms and sorted in order to provide the molecular signature, for instance the molecular signature () of height = 1 is given at the left; B) The coding of reactions signatures is illustrated for the 6-aminohexanoate hydrolase (EC 3.5.1.46). The reaction signature contains the net difference between the products and the substrates. In the figure, the reaction signature () was computed for height = 1; C) Illustration of how signatures of reactions provide a way to measure their chemical similarity. For example, the previous reaction (EC 3.5.1.46) has the same signature at height = 1 than 4-(-glutamylamino)butanoate amidohydrolase (EC 3.5.1.94). However, both signatures differ at height = 2, having in this case a Tanimoto similarity of (, ) = 0.81 (see Equation 14 in Methods). . A) Metabolic reaction map of , where endogenous metabolites are depicted as light blue nodes connected by edges representing reactions; B) Retrosynthetic map containing reachable compounds in the EMRS through exogenous reactions, where exogenous metabolites are represented by pink nodes connected through reactions (thin edges) to the network. There are 966 endogenous and 2338 exogenous compounds, respectively, that can be reached through reactions in the EMRS. There are 4,344 edges connecting endogenous compounds and 8,931 edges leading to exogenous compounds. Number of novel generated putative reactions in the EMRS for different heights . Decision flowchart for selecting and ranking best pathways The EMRS introduces putative novel reactions that share the same signature as their parent nominal reactions at the chosen height of molecular resolution (Equation 8 in Methods). Those putative reactions generated by our molecular signature-based algorithm need to be validated and ranked. Figure  shows the decision flowchart used in our approach in order to accept or reject putative reactions in a pathway as well as to score its overall performance once inserted into the chassis organism. Reactions are first tested for their thermodynamic feasibility. Next, if no known enzyme sequences are available in the database, the enzyme sequence space is searched in order to find candidate sequences that might catalyze the given reaction as a promiscuous activity. Gene compatibility, enzymatic performance, toxicity of products and steady state fluxes are finally estimated in order to score the pathway. We introduce the following function to quantify the cost of inserting an exogenous enzyme sequence processing the reaction * in the pathway: where () is the predicted enzyme promiscuity for the sequence , (*, ) is the estimated catalytic performance of the given sequence for reaction *, and () is the gene compatibility of the sequence . , are parameters used in order to weight the contribution of each term to the cost function. All three terms are normalized before entering the expression so that each score is always given by a value in the same range between 0 and 1. Therefore, the cost function in Equation 1 is always defined positive and bounded. Promiscuity contributes negatively to the cost function because enzymes with higher level of promiscuity are considered better candidates for catalyzing the desired transformation * as a side reaction. In the same fashion, enzyme performance contributes negatively since reactions with higher performance are considered less expensive in terms of the cost of insertion. Once all terms are defined for each reaction * in the EMRS, this strategy enables the determination of those gene sequences * that minimize the insertion cost: Furthermore, several additional adverse effects may be hindering the successful expression and performance of inserted enzymes, while the toxicity of intermediate metabolites might impede cell survival and growth. These effects need to be taken into account in order to rank the pathways. For instance, an estimate of toxicity values (IC50 or half minimal inhibitory concentration) for the intermediates in the chassis organism, may be obtained either from experimental databases  or from structure-activity relationship models . In addition, compound yields from inserted pathways are rarely additive, since other routes may be competing with the target pathway and inhibiting the production of the desired compound . Here we use a multi-criteria approach in order to score the cost of pathway insertion with respect to the general goal of producing a target molecule , with a cost function defined as follows: where (, ) considers the following effects: (), nominal yield of compound in pathway ; , minimum cost of insertion of each enzyme in the pathway as given by Equation 1; and tox(), the inverse of the IC50 value. Parameters (, , ) need to be adjusted in function of the desired weight given to the costs of pathway insertion and metabolite toxicity. In our method, these parameters were optimized so that pathways that are fully annotated in the reference database, for instance KEGG, are ranked first with respect to predicted pathways (see details in Methods). The minimum of this cost function (, *()) at the optimal pathway: provides a trade-off between the simultaneous goals of obtaining the maximum nominal yield while keeping the overall process efficient and side effects attenuated. In the following sections, we present our approach in order to quantify each term in the pathway cost function (, ) in Equation 3. . In order to rank pathways, each reaction = 1 ... in the enumerated pathways ... is first tested for thermodynamical feasibility; enzyme candidates are subsequently tested for performance and homogeneity so that the one with the lowest cost is selected; the cost of toxicity of each reaction product is then added; finally, the nominal flux is estimated for the overall pathway. Predicting enzyme activity in promiscuous putative reactions Our method provides for each reaction in the EMRS a ranked list of candidate sequences, as given by the score in Equation 1, along with their predicted catalytic efficiencies. When there is no sequence information in databases about enzymes catalyzing the desired reaction *, we must rely on the prediction of enzymes as putative candidates to process other substrates (multispecificity) or to catalyze a promiscuous reaction other than their native ones . Furthermore the thermodynamic feasibility of that reactions as well as the performance of the predicted promiscuous enzymes need to be evaluated. These preliminary evaluations, which are described next, are carried out in order to implement an early rejection of false hits, as shown in the flowchart of Figure . Putative reactions need to be validated for their directionality or thermodynamic feasibility. We performed this validation assuming that the metabolites' concentration are spatially invariant and that temperature and pressure are constant. Under these assumptions, standard Gibbs free energies of reactions can be estimated using a group contribution approach . Only reactions estimated to be thermodynamically feasible are added to the EMRS. As part of our methodology for biosynthetic pathway design, candidate enzyme sequences catalyzing feasible reactions in the EMRS have to be identified from the set of known enzymes. Namely, our procedure for extending the metabolic network relied on the underlying assumption that reactions with the same signature are likely to be processed by similar enzyme sequences , which in turn implies that the ability to catalyze the putative reaction is already present in the enzyme in the form of latent promiscuous activity. We have shown in a previous study  that enzyme multispecificity and promiscuity are properties that can be characterized by using a molecular signature representation. Thus, those multiple reactions generated in the EMRS from a nominal parent reaction can be interpreted as promiscuous activities predicted to be present in the set of known enzymes. Therefore, as shown in the decision flowchart in Figure , in order to consider a given sequence as a potential candidate that processes the putative reactions, a preliminary requirement has been introduced in the decision chart so that the enzyme should exhibit promiscuous activity based on the estimations performed by a molecular signature-based predictor (see Methods). The next step consists of searching for candidate enzymes to process a given reaction in the EMRS. In case that no known enzyme sequences were available for the reaction, candidate enzymes were determined by a signature-based enzyme-reaction predictor by following the procedure known as the tensor product . We assumed that best candidate enzyme sequences for a putative reaction were more likely to belong to the list of sequences known to catalyze reactions that are chemically similar to the given reaction. Therefore, reactions generated by the enumeration algorithm in the EMRS were first clustered into groups of similar reactions by a distance metrics, which was defined as the Tanimoto similarity of reaction signatures . The tensor product procedure (see Methods) was then used in order to locate best enzyme sequence candidates within the reaction cluster. In addition, performance of exogenous enzymes needs to be evaluated. We have developed a decision tree learning method to estimate enzyme activity  using kinetics information from the BRENDA database  (turnover rates, Michaelis constant , and inhibition constant ). As shown in Figure , predictions of enzyme performance perf(*, ) for the list of candidate enzymes entered into our decision flowchart in order to score the sequences in Equation 1. Quantifying the compatibility between the host and heterologous genes Another aspect to be addressed when considering the overall enzyme cost defined in Equation 1, is the effect of inserting heterologous genes, since the diversity of base-pair content is organism-specific. By minimizing this difference, expression levels can be maximized . In order to quantify the compatibility between the host and heterologous genes, we have implemented a machine-learning approach based on several descriptors: gene sequence descriptors (sequence length, GC content); organism specificity (phylogenetic distance between source organism and chassis); probability of protein expression as inclusion bodies; protein descriptors (percentage of hydrophobic and charged amino acids); and secondary structure distribution. These descriptors were computed for the entire KEGG database of non-redundant enzyme sequences and then used in order to train support vector machine-based predictors for the chassis organisms of interest (see Methods). Furthermore, the successful expression of a heterologous gene depends on several additional sequence-independent factors, such as an adequate selection of promoters, RBS, and codons . In some cases, we should also consider the need for some other type of specific modifications depending strictly on the type of compound to be synthesized, such as protein engineering of P450s  or modular design for the complex assembly machinery involved in the production of secondary metabolites like polyketides  and nonribosomal peptides , which need to be evaluated on a case-by-case basis in order to rank and select the best genes to engineer. Exogenous enzymes inserted in the chassis might catalyze reactions synthesizing new products in the organism. As a side effect, however, intermediate metabolites involved in the exogenous pathways as well as any other side product of the new reactions may induce undesired toxic responses in the cell. Therefore, it is necessary to consider toxicity effects of the compounds. For this purpose, we have developed a structure-activity relationship model based on a library of 150 tested compounds covering a wide range of toxicity levels . The model was built by using several molecular descriptors including molecular signatures as input descriptors, achieving a performance of = 0.68. For any given reaction in the EMRS, toxicity was given by the sum of the predicted toxicity for each product, allowing us to identify pathways involving highly toxic metabolites in order to rank them with lower score. Special consideration when predicting compound toxicity should be given to those cases when genes encoding for resistance to the compound are going to be engineered as part of the biosynthetic gene cluster. For instance, when producing an antibiotic in such as penicillin, it is necessary to introduce genes that code for -lactam resistance in the organism in order to make bacteria immune to that antibiotic. Therefore, if resistance to some product is going to be inserted into the strain, the attenuation effects in toxicity for that family of compounds has to be updated into the model. The insertion of new reactions into the chassis organism can perturb its metabolic network and therefore the equilibrium of the steady-state fluxes might be altered . By using a constraints-based flux analysis on a genome-wide reconstructed metabolic model of the engineered strain, we obtain the solution space within cell's capacity. Our objective is to maximize the production of the desired compound while keeping cell growth. For each engineered strain, we obtained an estimate of expected net yield of product, which is not further metabolized, at the given controlled media conditions. In addition, flux balance analysis is a flexible analytical technique that can also be applied in other ways in our design framework for biosynthetic pathways. For instance, it can be used in a systematic way in order to perform a sensitivity analysis to determine production bottlenecks, where overexpression and gene knockouts might enhance production for the target compound . Pathway enumeration and optimal search in the EMRS Given a biosynthetic pathway () that produces a compound , we have shown in the previous sections how to estimate the individual contributions to the cost function (Equation 3). By using the cost function, thus, biosynthetic pathways () can be ranked. However, in order to rank all viable biosynthetic pathways () for a compound of interest, the problem of pathway enumeration needs to be addressed. For this purpose, modeling of the metabolic network in the EMRS was done by using directed hypergraphs, where reactions are represented by hyperedges that connect sets of vertices (the substrates) to disjoint sets of vertices (the products) . Directed hypergraph formalism, though more complex than simple-graph models, provides a complete representation of all compounds involved in biochemical transformations. By using the hypergraph formalism, we implemented a retrosynthetic algorithm that enumerates all pathways starting from target compounds of interest. One main advantage of the pathway enumeration in the EMRS is that complexity can be controlled by tuning the atomic height of the molecular signatures. Higher values of imply that the number of pathways between two metabolites is approximately the same as the number of possible pathways in metabolic networks of annotated databases such as KEGG  or MetaCyc , while lower values generate more novel reactions and therefore more possible pathways are formed between those two metabolites. This result is illustrated for the case of pathway enumeration between chorismate and tyrosine in for different heights using a reaction representation at the level of the 3rd digit in the EC number classification (Figure ). In general, the possible number of pathways that can be formed between these two metabolites increases exponentially with the number of reaction steps. When values of the molecular signature height are high (≥ 6), new reactions are unlikely to be generated and therefore the number of pathways becomes the same as the number of pathways available in KEGG (the reference metabolic database); whereas as the height decreases, the number of new reactions and, thus, the number of pathways starts growing while getting closer to those results that were obtained in BNICE by using BEM matrices . In a general setting, the problem of finding the optimal pathway *() in Equation 4 that produces the target compound is equivalent to finding the shortest hyperpath in a weighted hypergraph. This problem is known to be an NP-hard problem , although it can be reduced to a polynomially solvable problem if the cost function in Equation 3 is reformulated as an additive objective function . In the EMRS approach, complexity can be controlled by varying the specificity of the molecular signature. This flexibility allows us to follow the strategy of enumerating all biosynthetic pathways () and computing their associated costs (, ) in Equation 3. Controlling the complexity of the pathway enumeration problem through molecular signatures . Comparison between pathway length distributions between tyrosine and chorismate for novel reactions generated by the BEM representation (BNICE) , the EMRS of heights = 3 to 6, and the original reactions in the KEGG metabolic database. Validation test for auxotrophic production in A validation test for the ranking score was carried out by testing its ability to identify native biosynthetic pathways for several essential metabolites (the 20 amino acids, citrate, ATP, ADP, GTP and GDP) in auxotrophic strains of . These strains were rendered unable to synthesize those essential compounds by inactivation of the enzymes that natively produce them. We assumed that native pathways, which have been selectively conserved under evolutionary pressure, are efficient ways to produce the compounds while keeping cell growth. The validation, thus, consisted of checking if the pathways that were ranked at the top of the list correspond to native pathways. In order to find all possible ways to synthesize the amino acids, we ran the retrosynthetic search in these auxotrophic strains. The output results of the search, which are given in Table , provided both native and alternative pathways connecting the auxotroph to the compounds. The results of this test showed that in 98% of the cases native pathways were found within the top 10 ranked pathways for each amino acid. An additional validation test was performed in order to evaluate the accuracy of the gene compatibility predictor. The result of this test, summarized in Table , showed that genes from the full list in the database that were predicted to be the best candidates to be inserted in the auxotroph strains corresponded significantly (-value 0.05) to native genes of . These results are significant since the sequences under test were not part of the training set used for building the gene compatibility predictor. In summary, this test showed that the proposed ranking function can potentially identify heterologous biosynthetic pathways to insert in an organism to produce a desired compound while selecting the ones that are close to native pathways in the chassis. Native pathway identification in auxotrophic Biosynthetic pathways for the 20 amino acids, citrate and ATP/ADP and GTP/GDP enumerated for strains where enzymes producing the compounds have been deleted. For each test, columns correspond to: total number of enumerated pathways; number of native pathways in the wild-type strain; percentage of native pathways in the top 10 best ranked pathways; and -values for the number of genes in strains top ranked with respect to the total enzyme genes in the database. As shown in previous sections, the procedure of pathway selection by retrosynthesis is a complex task that implies the adoption of several design decisions, some of them on a case-by-case basis. In order to help on the decision-making process, we have developed an online tool: the RetroPath webserver that guides the designer through the retrosynthesis process. The design starts by choosing the target compound, which can be given as an SDF molecular file. Additionally, the user decides the level of molecular resolution to use in the molecular signature representation. For instance, we have analyzed the set of molecular structures in DrugBank  as initial target compounds. For this set, we found that more than 50% of reactions producing these compounds belong to the EMRS of height = 6. Furthermore, the distribution of the number of alternative biosynthetic pathways in the compound set follows a power law, as it is shown in Figure , which means that in some cases there might be thousands of alternative pathways that have to be ranked according to the ranking function in Equation 3 to search for the optimal pathway. In order to illustrate the design process, we next present three examples of heterologous pathway design using the RetroPath webserver, the production of two -lactams antibiotics in (penicillin G and cephalosporin), and of one antitumor drug (taxol) in yeast. Retrosynthetic pathways for production of DrugBank compounds in . Percentage of compounds in the DrugBank database with alternative biosynthetic pathways in . Design examples of retrosynthetic pathways Production of β-lactams in E. coli The industrial production of penicillin G occurs via fermentation using the filamentous fungus . A recent study has opened up the possibility of producing penicillin G in an organism that is used as a producer of pharmaceuticals; the yeast . Interestingly, the biosynthetic pathways of penicillin G are shared by another -lactam antibiotic, cephalosporin, which is produced in the fungus and synthetised from isopenicillin N, the penultimate precursor for penicillin production . Using the retrosynthetic method that we have developed, retrosynthetic graphs were generated for -lactam antibiotics, in particular penicillin and cephalosporin (Figures ). The chosen chassis organism was . Four different pathways were found at a signature reaction height of = 4 for penicillin N production and in particular one involving the nonribosomal peptide synthetase -(L--aminoadipyl)-L-cysteinyl-D-valine synthetase (EC 6.3.2.26) and isopenicillin N synthetase (EC 1.21.3.1). These pathways are the same as those that were implemented in the aforementioned studies in yeast and fungi to produce the isopenicillin N. In the cephalosporin biosynthesis pathway the isopenicillin N is converted into penicillin N, itself transformed into deacetoxycephalosporin. The retrosynthetic maps of height = 4 for heterologous production of penicillin N and deacetoxicephalosporin in are shown in Figure . In the retrosynthetic graph, the enzyme deacetoxycephalosporin-C synthase (EC 1.14.20.1) is the one responsible of the deacetoxycephalosporin formation. Table  ranks the 6 pathways in the map leading to penicillin N according to the cost function in Equation 3. Toxicity values for intermediates were predicted by using our model built from an experimental library of toxicity values in while fluxes were estimated from a reconstructed metabolic model of , as described in the Methods section. The optimal pathway involves five exogenous enzymatic steps, while the alternative pathways involves up to seven steps. In Table , the alternative routes for the production of penicillin N are generated by the synthesis step of the precursor L-2-aminoadipate-6-semialdehyde, where the retrosynthetic search identified several enzymatic routes that can be connected to precursors in . Retrosynthetic maps for the production in of A) penicillin G and B) cephalosporin . Compounds in gray are endogenous to the chassis organism (); enzymatic reactions are represented as circles; branching compounds, which can be produced by more than one biochemical transformation, are (S)-2,3,4,5-tetrahydropyridine-2-carboxylate, L-2-aminoadipate-6-semialdehyde; the target compound is at the bottom of the plot. Ranked pathways for biosynthesis of Penicillin N in Each row corresponds to the insertion of one enzyme in the pathway in order to produce the given intermediate product in the second column. The estimated cost and product toxicity are given in the third column. The last two rows provide the estimate of maximum flux () for the pathway, and the total cost () according to Equation 3. C06564: Penicillin N; C05557: Isopenicillin; C05556: -(L--Aminoadipyl)-L-cysteinyl-D-valine; C00956: L-2-Aminoadipate; C04076: L-2-Aminoadipate-6-semialdehyde; C00450: (S)-2,3,4,5-Tetrahydropyridine-2-carboxylate; C00408: L-Pipecolate. Starred EC numbers correspond to putative enzymes. Production of taxol (paclitaxel) in yeast Taxol (paclitaxel) is an anticancer drug first isolated from the Pacific yew tree . Today, taxol derives largely by semisynthesis from the advanced taxoid 10-deacetylbaccatin III obtained from the European yew tree . Currently its production has a limiting rate as it depends on plant cell processes as well as chemical and biotechnological semisynthesis processes. For the past few years, a number of studies have been contributing to the elucidation of the biosynthetic mechanism of taxol and efforts have been made in order to attain cost-effective production through heterologous biosynthesis of taxol and its analogues . The retrosynthetic graph for yeast () which was computed for a signature height = 4, (Figure ), goes from the isopentenyl to taxol and contains 2 different pathways with 8 and 9 steps, respectively, that share most of the intermediates and only differ at two steps: 1. From isopentenyl (IPP) to taxadien-5-ol: The isopentenyl, native to yeast, undergoes 3 reaction steps to form the taxadien-5-ol. Those are catalyzed by the geranylgeranyl-diphosphate (GGPP) synthase (EC 2.5.1.29) that forms the GGPP (C00353) , by the taxadiene synthase (EC 4.2.3.17) that forms taxa-4(5),11(12)diene (C11894)  and finally by the taxadiene 5hydrolase (EC 1.14.99.37) that forms the taxadien-5-ol . The first two reactions have been reportedly implemented in  and, furthermore, were subject to engineering in order to optimize the taxadiene pathway production . 2. From the taxadien-5--ol to taxol: From the taxa-4(20),11(12)-dien-5-ol two pathways are possible, producing either taxa-4(20),11(12)-dien-5,13-diol by the taxane 13hydrolase (EC 1.14.13.77) or the taxa-4(20),11(12)-dien-5-yl acetate by the taxadien-5-O-acetyl transferase . Taxane 10hydroxylase (EC 1.14.13.76) is producing the taxa-4(20),11(12)-dien5,10-diol 5 acetate . This part of the pathway was implemented in the yeast . The next steps described successively the formation of 10-deacetyl-2-debenzoylbaccatin III (C11899), the 10-deacetylbaccatin III (C11700) catalyzed by taxane 2-O-benzoyltransferase (EC 2.3.1.166), and the Baccatin III catalyzed by taxane 2-O-benzoyltransferase  to finally form the taxol. Table  ranks the 2 retrosynthetic pathways in yeast leading to taxol production according to the cost function in Equation 3. In this example, toxicity of intermediates was not considered in the ranking (= 0) and therefore the optimal weighting terms in Equation 3 were taken accordingly (see details in Methods). The two alternative routes are given by the way the precursor 10-deacetyl-2-debenzoylbaccatin is produced. The optimal pathway involves 8 exogenous enzymes, while the alternative one involves 9 enzymes. Retrosynthetic map for the production of paclitaxel (taxol) in yeast . Compounds in gray are endogenous to the chassis organism (); enzymatic reactions are represented as circles; 10-deactyl-2-debenzoylbaccatin III appears as a branching compound; the target compound is at the bottom of the plot. Ranked pathways for biosynthesis of taxol in Each row corresponds to the insertion of one enzyme in the pathway in order to produce the given intermediate product in the second column. The estimated cost is given in the third column 3. The last two rows provide the estimate of maximum flux () for the pathway, and the total cost () according to Equation 3. C07394: Paclitaxel; C11900: Baccatin; C11700: 10-Deacetylbaccatin; C11899: 10-Deacetyl-2-debenzoylbaccatin; C11898: Taxa-4(20),11(12)-dien-5-acetoxy-10-ol; C11897: Taxa-4(20),11(12)-dien-5,13-diol; C11896: Taxa-4(20),11(12)-dien-5-yl; C11895: Taxa-4(20),11(12)-dien-5-ol; C11894: Taxa-4(5),11(12)-diene; C00353: Geranylgeranyl. Starred EC numbers correspond to putative enzymes. We presented in this work an automated protocol to assist synthetic biologists and metabolic engineers in the design and insertion of efficient heterologous biosynthetic metabolic pathways in chassis organisms. Our method is based on the retrosynthesis algorithm, an idea borrowed from the allied field of synthetic chemistry. In order to perform this analysis in metabolic networks, we used the molecular signature descriptor, a 2D representation of molecular graphs that provides a characterization of compounds and reactions in the network. Molecular signatures provide a homogeneous way to represent through hypergraphs the set of chemical species and transformations present in cell's metabolism. The representation in the molecular signature space is also an efficient way to measure chemical similarity between compounds and reactions. We use this framework to develop an algorithm to generate putative novel reactions between compounds in the network, leading to the extended metabolic reaction space (EMRS). The algorithm consists of searching for all combinations of compounds with the same signature as known metabolic reactions. In order to explore new biosynthetic pathways for compounds, we implemented a retrosynthetic algorithm in the EMRS to build the map of all reachable compounds from the chassis organism through biochemical transformations. The complexity of the retrosynthetic search, a problem that has been limiting so far the adoption of the retrosynthetic approach into the manufacturing pipeline, has been efficiently addressed in our method through the atomic height of the molecular signature. As increases, the number of possible pathways converges to the annotated pathways in metabolic databases. Lowering , in turn, leads progressively to a combinatorial explosion with multiple alternative pathways containing putative reactions, as the ones obtained in the bond-electron and atom tracking models of the metabolic graph. The retrosynthetic map contains both annotated and putative reactions catalyzed by identified exogenous enzymes, providing several alternative pathways leading to the target compound. We associated a cost of insertion to each pathway based on several criteria such as gene insertion cost, expression levels, enzyme efficiency and nominal fluxes. Furthermore, an algorithm similar to the shortest pathway search has been implemented in order to rank all possible pathways. We showed that the distribution of alternative biosynthetic pathways for in the list of compounds of medicinal interest in DrugBank follows a power law, being in some cases in the order of thousands. Therefore, it is necessary to implement an efficient ranking function as the one presented here in order to select the best heterologous pathways to insert in the chassis organism. For instance, we applied the retrosynthetic algorithm in order to search for heterologous biosynthetic pathways for two compounds in DrugBank: penicillin N and taxol. In both cases, several alternative pathways for bioproduction were found. The identified pathways contained both known biochemical transformations previously reported as well as other alternative pathways. In order to select the best combinations to engineer, pathways were ranked according to several cost factors such as number of inserted enzymes, gene compatibility, toxicity, and nominal fluxes. The individual contribution of these factors to the ranking function was optimally adjusted so that native pathways were ranked first with respect to predicted pathways. Our multi-criteria approach can be easily tuned depending on the data available for organisms, as it was illustrated by the optimal adjustment of the weighting parameters for different combinations of factors. The ability of the ranking function to identify native pathways was tested and validated in the case of biosynthetic pathways of several essential metabolites (amino acids, citrate, ATP/ADP, GTP/GDP) in auxotrophic strains of . In this test, native enzymes were correctly ranked by means of our methodology at the top of the enumerated biosynthetic pathways. Even though our methodology searches for enzymes providing the best performance for the overall process, we might be interested in some cases in increasing the efficiency levels for some of the promiscuous reactions involved in the pathway due to their poor performance, a rate-limiting factor in the production of the target compound. In that case, it would be necessary to introduce mutations in order to re-engineer enzyme variants with detectable levels of the desired catalytic activity. Using protein molecular signatures and kernel methods, we already proposed a methodology to search for promiscuity hot-spot residues in the enzyme sequence and outlined a method to find variants with enhanced promiscuity levels , which might be applicable in this case. Therefore, this work provides a full biosynthetic automated pipeline for the design and production of therapeutics and other compounds in flexible on-demand cell factories. Going beyond classical metabolic engineering, our synthetic biology approach meets the expected requirements of reusability and modularity that will become integral part of next generation biosynthetic devices. Let = (, ) be a molecular graph, where vertices correspond to atoms, and edges to bonds. An atomic signature is a canonical representation of the subgraph of surrounding a particular atom ∈ . This subgraph includes all atoms and bonds up to a predefined distance from the given atom, the signature height . The molecular signature is a vector whose components are represented in the space defined by a basis formed by atomic signatures. Initially developed for chemicals , the signature molecular descriptor was later extended to protein sequences . Each component of a molecular signature counts the number of occurrences of a particular atomic signature in the molecule. If = (, ) is a molecular graph, where vertices correspond to atoms, and edges to bonds, then the molecular signature of is given by: where () is the atomic signature of rooted at atom of height . We assume that enzymatic reactions take the general form: : + ... + → + ... + , where and are the stoichiometric coefficients of substrates and products . The signature of reaction of height is defined by the vector: In a metabolic network, the reaction space is formed by the set of reactions in the network, which are defined as ordered pairs of substrates ∈ and products ∈ belonging to the metabolite space : Metabolic reaction signature space Extended metabolic reaction space (EMRS) The signature reaction space () of height is given by mapping of the set of metabolic reactions ∈ into signature reactions () according to Equation 7. . The extended metabolic reaction space generated by signatures of height , (), corresponds to the inverse mapping from the signature space into the reaction space. Since the projection of into the signature space () involves some degeneracy, the regeneration of the metabolic map creates new putative reactions consisting of combinations of substrates and products that verify the reaction signatures in addition to the nominal ones: We define a measure of chemical similarity in the signature space between reaction signatures of height by using the Tanimoto similarity coefficient: where operations are applied into the vector space determined by the net difference of the signatures of products and substrates (Equation 7). This similarity measure focus on the reaction centers that define the chemical transformation rather than on the full atomic structure. As the height is increased up to the maximum diameter of the graph or canonical signature, the similarity measure extends further up to the rest of the molecular structure. By definition, two reactions and * that share the same signature up to some height possess identical signatures up to that molecular resolution : Reaction thermodynamic feasibility was computed through the estimation of Gibbs energy of the reaction by using a group contribution approach . This method considers the Gibbs energy of each metabolite species as the sum of the contributions of their constituents structural subgroups, estimated by linear regression from experimental data. We used the dataset given in  in order to compute metabolite Gibbs energy, whereas the reaction Gibbs energy is computed as the energetic balance between its products and substrates: where is the stoichiometric coefficient of each species, and Δtheir estimated Gibbs energy. was estimated by a support vector machine that was trained from the string or -mer spectra  of enzyme sequences () in KEGG  as inputs by defining the following kernel function: Enzyme promiscuity in the training set was defined by comparing the chemical similarity of reactions catalyzed by the enzyme sequence , as in : of the reaction signature space was performed by a hierarchical agglomerative algorithm using as distance metrics the chemical dissimilarity between reactions (, ): The optimal partition of the reaction signature space into , = 1...clusters was determined by the maximum average silhouette . prediction was computed within a given signature reaction space cluster by using a kernel approach known as tensor product . For each reaction cluster, a training set was built consisting of pairs of known enzyme sequences and reactions annotated in KEGG. This dataset was used in order to train a support vector machine defined by the following kernel function: where (, ) is the sequence string kernel defined in Equation 12 and (, ) is given by the reaction similarity matrix computed by using the reaction chemical similarity (, ) defined in Equation 14. was estimated through a decision tree algorithm implemented for each reaction cluster, as in . Performance data were based on the experimental kinetic constants and provided by the BRENDA database . Input features consisted of chemical descriptors of substrates and products in reactions and protein sequence descriptors. Sequence descriptors were computed from the EMBOSS package of sequence analysis . Phylogenetic distance between the source organism and chassis organism was computed from KEGG taxonomy. These descriptors were computed for the entire KEGG database of non-redundant enzyme sequences and then used to train support vector machine-based predictors for the chassis organisms of interest (and yeast). The training set consisted of a balanced positive set, formed by the list of sequences in the chassis strains, and a negative set formed by sequences selected randomly from the list of organisms other than the chassis. In the model of , we found that the average score for positive hits had a -score = 6.12 (-value = 9.56e-10) for a positive set of 24,894 sequences in E. coli strains among the total set of 681,518 sequences. We used this predictor in order to rank the annotated genes for a given enzyme class, where a -value was associated to each predicted gene by computing the probability of ranking that gene in the given percentile if it were picked at random from the list of genes. in the chassis organism was estimated through a partial least squares structure-activity relationship model implemented from an in-house database for of 150 compounds with experimentally determined IC50 (half maximal inhibitory concentration). Input descriptors of the model are given by the following molecular descriptors: molecular weight; solubility; average bond length; partition coefficient; molecular surface; and molecular signatures of the compounds. were predicted by using a reconstructed metabolic model of  and yeast  in the COBRA toolbox . For a given target compound ∈ and a putative exogenous biosynthetic pathway , an augmented model of the metabolic phenotype of the engineered strain was built from the reference model. The nominal flux of the desired compound () in the augmented model was obtained through linear programming optimization of the stoichiometric mass balance subject to the following constraints: where is the stoichiometric matrix, is the objective function of maximizing the biomass formation (growth) rate, ((), ) is a definite positive function that monotonically increases with both () and , and , are the model flux constraints . The chosen objective function in Equation 16 was ((), ) = () · , although in general other objectives might be possible as well (see for instance in ). Weighting parameters (, , ) in the cost function given by Equation 3 are adjusted by optimization. The chosen criteria is that pathways that are fully annotated in KEGG should be ranked first with respect to other pathways based solely on predictions. Our approach is similar to the one proposed in , although the main difference here is that we optimize the three parameters simultaneously for all metabolites in KEGG by using an estimate of ranking accuracy for each pathway within the full set of enumerated pathways in the EMRS. For a pathway ∈ () producing a given compound , we define its ranking accuracy as: where are the number of pathways of () in KEGG that are ranked at the same or higher score than , are the number of pathways of () not in KEGG which are ranked below , and |()| are the total number of pathways producing . The objective is to maximize the overall aggregate sum of extended to the list of enumerated pathways in the EMRS: For the ranking optimization problem, parameters (, , ) are not independent since a simultaneous increase of the same magnitude in the three parameters would leave the ranking unchanged. Therefore, in order to solve the problem, we need to fix at least the value of one of the parameters, for instance taking = 1.0 and = = 1. We give three possible solutions depending whether both toxicity and fluxes estimates are available or only one of them (see parameter variations in Additional file  Figures S1, S2 and S3): without considering fluxes (= 0.0), the optimal value for the toxicity parameter was ; without considering toxicity , the optimal value for the flux parameter was ; finally considering both toxicity and fluxes, the optimal values were obtained at , . The authors declare that they have no competing interests. JLF designed the retrosynthesis overall process. PC designed the experiments and pathway ranking strategy, collected the results, and wrote parts of the software. AGP designed and carried out the toxicity experiments, participated in the design of the pathway ranking strategy, and analyzed the retrosynthetic examples. DF developed the algorithms. PC, AGP, DF, and JLF wrote the manuscript. All authors read and approved the final manuscript. Pathway ranking accuracies for different values of parameters ( . Figure S1 plots pathway ranking accuracy for different values of parameter without considering fluxes (= 0); optimal value is obtained for . Figure S2 plots pathway ranking accuracy for different values of parameter without considering toxicity (= 0); optimal value is obtained for . Figure S3 plots pathway ranking accuracy for different values of parameters (, ); optimal values are (, )..