Robustness against perturbations and uncertainties is fundamental to biological systems that continuously sense and respond to their environment. At the cellular level, it is often desired to maintain precise control over a variety of molecular components and pathways to achieve complex behaviors that require the interaction of intracellular or extracellular biomolecules. This is often achieved by tightly regulating gene expression in such a way that it follows a desired set point independent of exogenous or endogenous disturbances. Feedback is a mechanism that enables organisms to achieve reliable and robust functionality. Feedback mechanisms underlie homeostasis, a phenomenon in which physiological variables are continuously monitored and adjusted so as to maintain a desired equilibrium value which is defined by a set point (also known as a reference signal), in the presence of biological uncertainties that may perturb the natural state of the system. Reference tracking in the presence of disturbances, a classical objective in electrical and mechanical systems, is often solved by incorporating integral feedback to control a variable of interest (also known as a plant or process signal). In such a scheme, one wants the plant signal to track a reference signal. This is achieved by incorporating in the controller the mathematical integration of the difference between the reference and the plant signal (the error signal). The internal model principle in control theory states, in essence, that the existence of an integrator in the control loop is necessary for the tight regulation of the variable of interest in the presence of constant disturbances or stimuli. Inspired by these ideas from engineering and control theory, there have been several recent designs and implementations of biomolecular integral feedback controllers. While these implementations provided a general framework to robustly regulate in vivo biological processes, an alternative implementation is desirable, in order to improve the robustness of synthetic biological processes and specifically the cell-free reaction platform. In addition, the cell-free reaction platform makes the design and implementation of such a controller easier compared to in vivo systems. This is mainly due to the limitations of quantitative predictive models for the latter case. These limitations arise in large part from the biological noise which is found in cellular systems, which makes it hard to achieve precise control over model parameters, thus complicating the design and feasibility of the system. Plasmid copy number is also limited by the origin of replication, decreasing the adjustability of experiments. In this work, we exploit the versatility of an all  TXTL platform to prototype a biological controller circuit. TXTL reactions contain the native transcription, translation, and metabolic machineries required to achieve gene expression over at least eight hours. As opposed to a living host, in a TXTL reaction one can precisely set the concentrations and stoichiometries of DNA parts, and thus finely tune gene circuits easily. TXTL reactions are typically performed at the microliter scale or above, far from any biological noise, thus allowing flexibility in designing and optimizing the genetic network. Experimental disturbances, such as those perturbing the amount of DNA or other reaction components, can be carried out at any time. TXTL reactions are executed in high-throughput, facilitating the rapid characterization of dynamic circuits. By virtue of such advantages, several synthetic gene circuits have been implemented in TXTL with a successful modeling framework. In this article, we construct an in vitro synthetic biomolecular integral controller that precisely controls the protein production rate of an output gene. Our strategy relies on a molecular sequestration reaction, which is an instantiation of the innovative antithetic integral feedback paradigm introduced by Briat, Gupta, and Khammash, who showed that this architecture realizes integral control and achieves robust tracking. To realize a cell-free biological controller, we exploit the natural interaction between the  σ and the anti-σ factor. Recently, a similar controller has been reported that uses the same molecular mechanism to realize integral feedback in . In this work, we demonstrate that the output of the controller, which is realized using the TXTL toolbox, tracks the reference signal, meaning in this paper that it is linearly proportional to the input; moreover, we show that this happens for a large dynamic range of inputs. This tracking behavior is possible only in the closed-loop configuration (when the sequestration reaction is active), and not in open loop. We develop an ordinary differential equation (ODE) model and perform systematic TXTL experiments in order to parameterize and validate the model. We then use the parameterized model in order to successfully predict the controller response in different reaction conditions. When certain disturbances are added in the biochemical species as local disturbances, or in the reaction condition as a global disturbance, only the closed-loop controller enables the output to almost reject the disturbance’s effect on the output. Our results demonstrate that our synthetic biomolecular controller is capable of regulating the gene expression rate robustly in an  TXTL toolbox. We anticipate that such an approach could be useful for diagnostics applications, for constructing dynamical systems in vitro or for programming synthetic cell systems. Designing an integral feedback controller Our primary goal is to construct a genetic network which can accurately regulate the protein production rate of a target gene. Specifically, we wish to achieve reference tracking, meaning that the production rate (output) of a desired protein follows a reference signal linearly, for a large dynamic range of input values. We call tracking robust if the output tracks the reference signal even in the presence of (certain kinds of) disturbances and this behavior is maintained independently of changes in reference values over the course of the reaction. The synthetic biological integral controller. 41467_2019_13626_Article_IEq1.gif 41467_2019_13626_Article_IEq2.gif 41467_2019_13626_Article_IEq3.gif 41467_2019_13626_Article_IEq4.gif 41467_2019_13626_Article_IEq5.gif 41467_2019_13626_Article_IEq6.gif 41467_2019_13626_Article_IEq7.gif Block diagram of a typical closed-loop controller.  Design of the synthetic biological integral controller, where the color coding corresponds to the blocks shown in . The reference is set by the input DNA  and the plant signal  (mRNA of gene ) is measured through the expression of another gene , which encodes for a protein . Error computation is achieved through a molecular sequestration reaction between the proteins  and . Here the red-color cross represents the open-loop configuration of the controller, which results when the feedback signal  is absent.  In the closed-loop configuration, the error criterion is the difference between scaled versions of the input  and the plant signal to be regulated, . In the actual controller implementation, this role is played by the free amount of the protein , which we denote as  because we think of it as what remains after binding to  (and to promoter sites). To produce an output () that is independent of the disturbances in  and , the error signal is integrated (see Supplementary Note ). The assumptions made to derive this expression are mentioned in Supplementary Note  where it is also shown that the controller output () linearly depends on the plant signal at the steady state. In the absence of the feedback the output depends nonlinearly on  and  such that any disturbance in  may perturb the output.  Overview of the  cell-free toolbox for prototyping and executing parts and circuits in vitro.  Experimental implementation of the integral controller. Three plasmids are used, P-, expressing the  () from a  promoter (), P-FlgM, expressing the anti- factor () from a  promoter , and P-deGFP, expressing the reporter deGFP () from a  promoter . In the open-loop controller, instead of the anti- factor (FlgM), mSA is expressed, which is not sequestered by , nor does it directly affect any reaction rates (see Methods). The  control gene promoter is denoted as . In electrical and mechanical control systems, integral feedback controllers are routinely used in order to achieve robust reference tracking in the presence of perturbations and uncertainties. Motivated by this analogy, various possible designs of such controllers have been discussed substantially in the context of biological systems. The present work is inspired by our previous work, in which we introduced a computational design based on RNA-based controllers but in which no experimental validation was provided. Here, we start from that design, modifying it to allow for direct control over genetic expression and provide an experimental validation. In this approach, the controller enables the output signal to robustly track the reference signal, which is a scaled value of an input  (Fig. ), and representing input gene copy number. To determine the deviation of the output signal from the reference signal, a comparison between both is required without affecting their activity. This requires that the reference and the output signals must be sensed internally using biochemical sensors. We, therefore, use a protein molecule , which corresponds to the reference signal and is assumed to be proportional to the input , and a protein molecule , which corresponds to the output signal and is regulated and proportional to a plant signal . This allows to realize the error computation while avoiding depletion of the reference and the plant signals. In informal terms, we may think of the concentration of free molecules , which we denote as  (the  for remaining after binding to ) as an error signal which represents the difference − and influences the output to correct deviations of the output signal from the reference signal. The output block, which is not involved in the closed-loop dynamics, acts as a proxy to read the plant signal and produce an external read-out signal (see Supplementary Note ). 41467_2019_13626_Article_IEq8.gif 41467_2019_13626_Article_IEq9.gif 41467_2019_13626_Article_IEq10.gif 41467_2019_13626_Article_IEq11.gif 41467_2019_13626_Article_IEq12.gif 41467_2019_13626_Article_IEq012.gif 41467_2019_13626_Article_IEq13.gif 41467_2019_13626_Article_IEq14.gif 41467_2019_13626_Article_IEq15.gif 41467_2019_13626_Article_IEq16.gif Our biomolecular implementation of an integral feedback controller requires three genes: an input gene , under the promoter , a target gene , under the promoter  and an output gene , under the promoter  (Fig. ). Genes , , and  are sensed using their respective encoded proteins , , and  via a combination of transcription and translation reactions. An error computation is achieved through a molecular sequestration between  and , which represent  and , respectively, in such a manner that when  binds to  or vice versa, both proteins become biologically inactive (a phenomenon, also known as annihilation). We then used the free  (not bound to ) as a transcriptional activator that binds at the promoter regions of  and  genes. In this reaction, inactive promoters  and  switch to active promoters  and  states respectively, leading to an increased production rate of the respective encoded proteins. It is essential that the activated transcription rate from the genes  and  must be much higher than their basal expression, so that the production rate of  and  should be overall regulated by the error signal . Since the plant signal ( is a mRNA) is not a readable quantity, and  gets depleted in the sequestration reactions, we use the concentration of another protein  (e.g., a reporter protein), which is expressed by the output gene , as a read-out signal to record the controller activity. The production rate of protein  (considered as an output ) is used as a reliable comparison metric. To ensure that the output signal truly represents the plant signal, and for that  must truly represent . In order to implement this, it is necessary that the same promoter must be used by the  and  genes, and the amounts of  and  should be identical. Note that , , and  have the same concentrations and correspond to the biochemical species , , and , respectively. 41467_2019_13626_Article_IEq17.gif Here and elsewhere, the term closed-loop configuration means that the feedback is present through the sequestration reaction; otherwise, when the feedback mechanism is not present, the controller is referred to as in the open-loop configuration. We establish that reference tracking is only possible in the closed-loop case, where the output linearly depends on  (Fig. ). In the open-loop case, the output depends nonlinearly on  and , which means that, according to our definition, the open-loop system is unable to track the reference signal. Because the error signal () is mathematically integrated over time in the closed-loop case, the output should be able to track the reference signal even when appropriately placed disturbances are added to the genetic network (Fig. , c). For a case when the reference signal is larger than the output signal, the error signal increases the production of the output . On the other hand, when the output signal is larger than the reference signal, free  sequesters  to reduce the output. One of the key reasons that this controller is able to improve substantially upon that in ref.  is that it implements an effective error computation through protein interactions; in contrast, RNA-based designs suffer from the fact that RNAs degrade much faster than proteins, making an effective error computation very hard to implement experimentally. In contrast, the degradation of the proteins used in this work can be ignored as no degradation tags were associated with them. However, while realizing the integral controller in vivo, the adverse effect of degradation on reference tracking due to cell dilution should be considered. 41467_2019_13626_Article_IEq18.gif 41467_2019_13626_Article_IEq19.gif 41467_2019_13626_Article_IEq20.gif To test the controller experimentally in  TXTL toolbox (Fig. ), we employed three plasmids (Fig. ): P-, expressing  from a  promoter; P-FlgM, expressing the anti- factor (also known as FlgM) from a  promoter; and P-deGFP, expressing the reporter deGFP from a  promoter. In the open-loop controller, gene expressing FlgM is replaced by a gene expressing mSA (same protein size), which cannot sequester with , nor does it directly affect any reaction rates (see Methods). Here and elsewhere, for simplification, , anti- factor (FlgM), and immature deGFP are denoted as , , and , while promoters P and P are denoted as  and  (same as ), respectively, and the  control gene is denoted as  and the respective promoter as . The closed-loop controller tracks the reference signal 41467_2019_13626_Article_IEq21.gif 41467_2019_13626_Article_IEq22.gif 41467_2019_13626_Article_IEq23.gif The output follows the input signal linearly only in the closed-loop configuration. 41467_2019_13626_Article_IEq24.gif 41467_2019_13626_Article_IEq25.gif 41467_2019_13626_Article_IEq26.gif 41467_2019_13626_Article_IEq27.gif 41467_2019_13626_Article_IEq28.gif 41467_2019_13626_Article_IEq29.gif 41467_2019_13626_Article_IEq30.gif 41467_2019_13626_Article_IEq31.gif TXTL deGFP measurement of the response of the integral controller in the  open-loop and  closed-loop configurations at different initial concentrations of  (0.1–0.7 nM) while initial  and  were both 1 nM each. In the open-loop, instead of ,  was added.  The slopes of measured deGFP responses for the  open-loop and  closed-loop operations and the corresponding summary in  and  at 8 h respectively. To disable the feedback in the open-loop case  was replaced by , which expresses a protein that cannot sequester with .  Summary of the deGFP slopes of the controller at 8 h for a step change in  for the  open-loop and  closed-loop operations.  was increased from 0 nM to different concentrations (0.1–0.7 nM) after 4 h of the reaction in the presence of initial 1 nM 
 and  each. Note that the lower GFP slope values in  than  are due to the shorter active reaction time. Error are shown in the shaded region and were determined using the standard error of the mean of three or more repeats. A linear regression with zero intercept was used to fit the deGFP slopes and the corresponding -square values are  0.71,  0.98,  0.84, and  0.98. A calibration factor was used to convert the measured deGFP fluorescent signal into the concentration. Before calculating deGFP slopes, measured deGFP responses were smoothed-out using the  smoothing method in MATLAB. Source data are provided as a Source Data file. Our first goal was to establish that when the controller operates in the closed-loop configuration, the output of the controller () follows linearly the changes in the concentration of input , thus tracking the reference signal. A nonlinear dependence of the output on  would suggest otherwise. To test this in TXTL reactions, we added 0.1–0.7 nM  and 1 nM each of  and either for the open-loop operation (Fig. ) or  for the closed-loop operation (Fig. ). In our implementation, the controller’s output is an immature version of the reporter protein deGFP, and its matured version, which is fluorescent, is considered as a read-out signal (). Since the fluorescent deGFP has no degradation tag; consequently, we cannot observe a steady-state behavior in the measured responses. Therefore, to be able to compare the open and closed-loop responses accurately, we determined the slopes of the measured deGFP signals (Fig. , d), which is also referred to as the production rate of deGFP. It can be shown that deGFP slope is a scaled version of , which follows the plant signal linearly at the steady-state in the closed-loop configuration (Supplementary Note ). In the open-loop case, we found that changes in the deGFP slopes depend nonlinearly on the changes in the input concentration of  (Fig. ), suggesting that the output is unable to track the reference signal over the tested range. In contrast, the closed-loop endpoint deGFP slopes were linearly proportional to the concentration of  (Fig. ), suggesting reference tracking. 41467_2019_13626_Article_IEq32.gif 41467_2019_13626_Article_IEq33.gif 41467_2019_13626_Article_IEq34.gif The output of the closed-loop controller should be able to follow the changes in input signal linearly independent of the time when it is modified. To test this capability, we performed a step change in the input  concentration during the course of the reaction. For that, we added different amounts of  to TXTL reactions in the open-loop (Supplementary Fig. ) and closed-loop (Supplementary Fig. ) system after four hours of incubation with 1 nM each of  and either  or , respectively. As mentioned earlier, we observed that the controller’s output follows linearly the input only when operated in the closed-loop configuration (Fig. , h). Note that the deGFP produced in the closed-loop configuration is much smaller than that produced in the open-loop configuration because the activator needed to express the deGFP is sequestered only in the closed-loop configuration. 41467_2019_13626_Article_IEq35.gif 41467_2019_13626_Article_IEq36.gif The open-loop controller output is unable to track the input signal. One possibility is that this observation can be explained by the higher output levels in the open-loop case. To eliminate this possibility, we tested the controller operation in a different reaction condition, by ensuring that the open-loop output levels are in close proximity to the closed-loop output levels (shown in Fig. ) at the same input  values. We found that the open-loop controller output remains nonlinear as a function of , even when the open and closed-loop output levels are similar (Supplementary Fig. ; Fig. ). This provides a controlled comparison and shows that feedback is responsible for the reference tracking behavior. As a control, we also tested that changes in the concentration of  have no effect on the deGFP slopes (Supplementary Fig. ), confirming that the different version of  that is expressed by  gene does not interact with . In contrast, when we increased the concentration of , from 0 to 1 nM in the presence of  and , the deGFP slopes reduced significantly, suggesting that the sequestration reaction is being actively involved in regulating the error signal and thereby the output activity (Supplementary Fig. ). We also found that in the absence of , deGFP is not produced (Supplementary Fig. ), confirming that the production of  and  are fully governed by the error signal through the activation reaction. These experimental observations agree with the expected controller operation. When  is larger than  (i.e., the output is lagging behind the reference). The error signal increases the production of  and . As more  is available in the reaction to sequester with ,  and  converge to specific values that would allow  to follow the reference signal. In the absence of the sequestration reaction, error computation is absent (no feedback) and so  directly regulates  production without comparing with the reference signal. Mathematical model and parameterization 41467_2019_13626_Article_IEq37.gif Schematic of the model parametrization process and validation of the model. 41467_2019_13626_Article_IEq38.gif 41467_2019_13626_Article_IEq39.gif 41467_2019_13626_Article_IEq40.gif 41467_2019_13626_Article_IEq41.gif 41467_2019_13626_Article_IEq42.gif 41467_2019_13626_Article_IEq43.gif 41467_2019_13626_Article_IEq44.gif 41467_2019_13626_Article_IEq45.gif Detailed reaction network of the controller and the corresponding.  ODE model. Here ,  and  are the translationally initiated mRNA of the , , and  proteins, respectively. The additional reaction was added into the model to consider the maturation of immature deGFP into a fluorescent deGFP (). Details on how the  and  promoters switch from the inactive (, ) to active  states are shown alongside. Note that while using the ODE model to study the controller dynamics,  and  were replaced with  and  respectively.  Comparing the measured deGFP response (solid lines) with the mean of the best-fitted simulation results (dashed lines) for the  open-loop and  closed-loop cases. The ODE model was used to calculate the controller response while initial concentrations of  and  were 1 nM each. Note for the open-loop response 
, 
, , , and  were set to zero. Least squares fitting was used to generate the best-fit model response at different initial guesses of the reaction parameters (see Methods). Experimentally observed error bars are shown in the shaded region while the mean simulated trajectories (dashed line) are shown here within 95% confidence intervals.  = 1000. Error bars are from the SEM of at least three repeats. Source data are provided as a Source Data file. To understand the controller operation, we developed a simple coarse-grained model that captures the dynamic response of the controller in both open and closed-loop configurations (Fig. ). For that, we consider the synthesis of each protein as a two-step reaction: a transcription reaction for mRNA synthesis and then a translation reaction for the corresponding protein synthesis. The parameters  and  are transcription and translation rates, respectively. Here and elsewhere, subscripts to the parameters indicate the corresponding species. Each mRNA species (, , and ) has a degradation rate denoted as  while we ignore the protein degradation rate. The parameter  is the sequestration rate. Transcriptional activation is modeled as a one-step reaction, where  binds to the promoters  and  separately at a rate of  and dissociates at a rate of . In the activated state, these genes produce  and  proteins at an increased transcription rate, denoted as . Considering the mass-conservation, we assume that  at all times. An additional reaction is added into the model to account for the maturation of newly synthesized immature deGFP () into a fluorescent deGFP (), which is the read-out signal (Fig. ). We have also added a reverse sequestration reaction that allow sequestered  and  to dissociate at a rate denoted as . From chemical reactions, we built an ODE model (shown in Fig. ) to determine the response of the controller over time. Estimated model parameters obtained from the least squares fitting for the ODE model shown in Fig. . Note for the open-loop response 
, 
, , , and  were set to zero. The error values were determined using the standard error of the mean.  = 1000 An accurate representation of a system model requires determining specific parameter values at which the model quantitatively follows the system dynamics. However, parameter estimation can be nontrivial, as there can be multiple sets of parameter values that may vary by several orders of magnitude and could still fit the measured data. Therefore, to simplify the problem, we isolated the measured responses into two sets, in such a manner that we required fewer parameters to fit a particular set of experimental data. For this, we first found the model parameter values that provided the best fit to the measured open-loop response, since the number of parameters involved in the open-loop case are less than in the closed-loop case (see Methods). We then used these parameter values to fit the closed-loop response while allowing only the remaining parameters to vary (see Methods). Moreover, we started the model fitting manually with an initial guess of parameters derived from the literature. Once we found the possible values that provide a qualitative agreement between the model and the measured response, we used an iterative least-squares fitting procedure to find a range of parameter values that gave us the best fit (see Methods). The means of the resulting parameters (Table ) were then used along with the ODE model (Fig. ) to calculate the mean trajectories with 95% confidence intervals (Fig. , d). A comparison of model response with the deGFP slopes is shown in Supplementary Fig. . Histograms of the input and estimated parameter distributions are shown in Supplementary Fig. . 41467_2019_13626_Article_IEq46.gif 41467_2019_13626_Article_IEq47.gif Validation of the controller model and simplification. 41467_2019_13626_Article_IEq48.gif 41467_2019_13626_Article_IEq49.gif 41467_2019_13626_Article_IEq50.gif 41467_2019_13626_Article_IEq51.gif Predicting the  open-loop and  closed-loop controller response for a step change in .  was increased from 0 nM to different concentrations (0.1–0.7 nM) after 2 h of incubation in the presence of initial 0.7 nM of  and  each. (Recall that fitting was done under different conditions, namely 1 nM of  (or ) and  each.) The ODE model shown in Fig.  was used to determine the response with parameters shown in Table .  Simplified ODE model of the controller.  Approximate analytical solution for deGFP slopes (time derivative of ) for the open and closed-loop cases. ,  Comparing the measured responses of the controller shown in Fig. , d with the response determined using the approximate analytical solution for the  open-loop and  closed-loop cases respectively. The data shown in Fig. 4a, b are compared with the analytical solution results in Supplementary Fig. . Before calculating deGFP slopes, measured deGFP responses were smoothed-out using the  smoothing method in MATLAB. Error bars are from the SEM of at least three repeats. Source data are provided as a Source Data file. To cross-validate the parameterized model, we predicted the controller response for a different setting of input conditions. For that, the concentration of  was increased from 0 nM to 0.1–0.7 nM (in a step manner) after 2 h of incubation in the presence of initial 0.7 nM of  and  each (Fig. ; Supplementary Fig. ). We found that the predicted responses followed the measured responses closely. It should be noted that the reason, in this study, we have limited to model the measured dynamic trajectories for up to 8 h. This is because experimentally, after 8 h, we observed the effects of resource limitations (Supplementary Fig. ) and the ODE model shown in Fig. , assumes an unlimited energy source and therefore ignores the experimental results when that assumption no longer holds. 41467_2019_13626_Article_IEq52.gif 41467_2019_13626_Article_IEq53.gif To get a better insight into the controller response, further simplification of the proposed model is required. For that, based on the extracted parameter values, we sought to reduce the number of variables in the model while still capturing the essential dynamics of the controller. From the extracted parameter values, we observed that the basal expression of  and  genes is almost negligible; therefore, we set  and  to zero in the simplified model. As the transcriptional activation reaction is much faster than the other reactions involved in the reaction network, we used a quasi-steady state approximation to replace the ODEs of  and  by their steady-state expressions (see Supplementary Note ). As the RNA dynamics is much faster than the protein dynamics (due to the faster RNA degradation rates), a similar approximation was used to model the synthesis of  and  using single reactions for each, while keeping the two-step synthesis of  to ensure that we consider an appropriate delay in the overall system dynamics (Supplementary Fig. ). We also ignored the reverse sequestration reaction () assuming it has a limited impact on the dynamics of the deGFP (Supplementary Fig. ). This leads to a simplified model (shown in Fig. ), which can produce a dynamic response similar to that of the original model (Supplementary Fig. ). We now use the simplified model to determine analytically how the output depends on the reaction parameters and the input. As mentioned earlier, because the reporter protein deGFP () has no degradation tag, we opted to analyze the slope of deGFP (scaled value of ), and a steady-state response can be seen for the closed-loop controller (Fig. ). However, in the given implementation, it is not possible to observe a steady-state response of  in the open-loop configuration (Fig. ). This is because as the sequestration reaction is absent in the open-loop case,  continues to accumulate over time and so does  (Supplementary Fig. ; Fig. ). In contrast, due to the sequestration reaction in the closed-loop operation,  attains a steady-state, which makes  to attain a steady-state as well (Supplementary Fig. ; Fig. ). To determine an approximate analytical expression for the slope of deGFP, we used the simplified model to obtain an approximate analytical solution of  (see Supplementary Note ). We then analytically calculated the time derivative of  for the open and closed-loop cases (Fig. ). The analytical solution follows the response of the original model closely at different reaction conditions (Fig. , f; Supplementary Fig. ), and thus, validating our approach. Moreover, we found that the time derivative of  (same as slope of deGFP) follows the input  linearly only in the closed-loop case as long as there are enough promoter sites are available on  and  genes. This is due to the fact that in the closed-loop configuration,  is independent of the promoter activity of  gene as long as  ≫  is not valid. This is considered as a fundamental limit of the controller to track the reference signal robustly. In contrast, in the open-loop case, as the sequestration reaction is absent, production of  directly depends on the promoter activity of  gene which causes a nonlinear dependency of  on , thereby on  (Fig. ). In the closed-loop case when  ≫ ,  converges to a saturation. We verified these conclusions using the numerical simulations (see Supplementary Fig. ). Moreover, the closed-loop controller capability to track the reference signal should be independent of the absolute value of the output when  ≫  is not valid. To test this, we conducted numerical simulations at different initial DNA concentrations values for the open and closed-loop cases in such a manner that the controller’s output remains in the proximity in these two cases. We observed linear relation between the input  and the output only for the closed-loop case (Supplementary Fig. ). Further insight into the controller operation can be gained by analyzing the simplified model to determine how the error signal is processed in the closed-loop configuration of the controller. The analytical expression for the error signal clearly shows that it is integrated mathematically by the controller (see Supplementary Note ). We then further validate the conditions under which  faithfully tracks the plant signal, which ensures accurate reading of the controller dynamics (see Supplementary Note ). Closed-loop control enables disturbance rejection 41467_2019_13626_Article_IEq54.gif 41467_2019_13626_Article_IEq55.gif One of the main theoretical advantages of integral feedback controllers is their ability to reduce the effect on the output of certain constant disturbances on the variable of interest. This is due to the effective error computation with an integral operation that allows the controller to maintain the desired output even when a disturbance affects the system. In the aforementioned section, we showed that the implemented controller can be interpreted as an integral feedback mechanism (see Supplementary Note ). Therefore, we expect that the closed-loop system is able to suppress disturbances in an appropriate sense. To test this, we introduced disturbances in the concentration of the biochemical species  and . In practical settings, variation in the DNA concentration is one of the most biologically relevant parameters. This is because in vivo gene concentration can vary significantly due to fluctuations in plasmid copy number, and several designs have been proposed in order to ameliorate the effect of copy number variation. Notably, the TXTL reaction platform allows us to design such an experiment, where DNA template concentrations can be changed at any time during the course of a reaction due to the TXTL reaction settings. 41467_2019_13626_Article_IEq56.gif 41467_2019_13626_Article_IEq57.gif 41467_2019_13626_Article_IEq58.gif 41467_2019_13626_Article_IEq59.gif 41467_2019_13626_Article_IEq60.gif 41467_2019_13626_Article_IEq61.gif In this design, the steady-state value of the closed-loop controller’s output is independent of the amount of  and  genes (in Fig. ), and this implies that any disturbances in these species should not perturb the deGFP response when the controller is operated only in the closed-loop configuration. To test this, we first used the ODE model (Fig. ) to predict the controller response in the open-loop and closed-loop configurations where the concentrations of  and  were varied from 0.2 to 0.7 nM, keeping a fixed 0.2 nM initial . We observed a less than ~1.2-fold variation in the deGFP slopes for the closed-loop case, compared to ~4-fold variation in the open-loop case (Supplementary Fig. ). To understand these further, we conducted numerical simulations and analyzed the dynamics of each species involved in the genetic network. We found that in the closed-loop operation, an increase in  increases the amount of , but as more  is available to sequester , less free  (not bound to ) is available to activate the production of  and . Even though  was increased, free  is reduced such that the reporter protein  (and also the output ) remains almost the same, independently of the amount of  (Supplementary Fig. ). For the open-loop case, as there is no feedback, an increase in  significantly increases the production rate of  (Supplementary Fig. ). 41467_2019_13626_Article_IEq62.gif 41467_2019_13626_Article_IEq63.gif 41467_2019_13626_Article_IEq64.gif Closed-loop operation enables the controller to achieve robustness to the local disturbance on the system. 41467_2019_13626_Article_IEq65.gif 41467_2019_13626_Article_IEq66.gif 41467_2019_13626_Article_IEq67.gif 41467_2019_13626_Article_IEq68.gif 41467_2019_13626_Article_IEq69.gif 41467_2019_13626_Article_IEq70.gif 41467_2019_13626_Article_IEq71.gif 41467_2019_13626_Article_IEq72.gif 41467_2019_13626_Article_IEq73.gif 41467_2019_13626_Article_IEq74.gif 41467_2019_13626_Article_IEq75.gif 41467_2019_13626_Article_IEq76.gif Measured deGFP response of the controller in the presence of disturbances in the concentration of  (or ) and  (0.2–0.7 nM) for the  open-loop and  closed-loop cases while initial  was 0.2 nM. The error bars are shown in the shaded region and were determined using the standard error of the mean of three or more repeats. ,  Summary of the deGFP slopes of the controller at 8 h for the  open-loop and  closed-loop operations. Error bars are from the SEM of at least three repeats. To disable the feedback in the open-loop case  was replaced by , which expresses a protein that cannot sequester with .  Measured response of the controller when the disturbance in  and  was added in a step manner for the  open-loop and  closed-loop cases. Additional  and  were added (0.1–0.5 nM) after 4 h of the reaction in the presence of initial 0.2 nM of ,  and  each. ,  Summary of the normalized deGFP slopes of the controller at 8 h for the  open-loop and  closed-loop operations. Normalization was done with respect to the first slope value for each variation in  and . The predicted response for each case was determined using the ODE model shown in Fig.  with parameters shown in Table . Before calculating deGFP slopes, measured deGFP responses were smoothed-out using the  smoothing method in MATLAB. Source data are provided as a Source Data file. Encouraged by these results, we experimentally tested the same conditions in TXTL reactions. We added 0.2 nM  and increasing concentrations of , from 0.2 nM to 0.7 nM to reactions, and tracked the deGFP signal over time for the open-loop (Fig. ) and the closed-loop (Fig. ) configurations. In the open-loop case, the output signal increased by more than ~4.5-fold with the increasing concentration of  due to the lack of feedback (Fig. ). However, in the closed-loop case, the output signal was increased by only ~1.4-fold with increasing , thus confirming that the controller suppressed the disturbance in their concentrations (Fig. ), as predicted by integral feedback theory. 41467_2019_13626_Article_IEq77.gif 41467_2019_13626_Article_IEq78.gif 41467_2019_13626_Article_IEq79.gif 41467_2019_13626_Article_IEq80.gif 41467_2019_13626_Article_IEq81.gif 41467_2019_13626_Article_IEq82.gif 41467_2019_13626_Article_IEq83.gif 41467_2019_13626_Article_IEq84.gif 41467_2019_13626_Article_IEq85.gif 41467_2019_13626_Article_IEq86.gif 41467_2019_13626_Article_IEq87.gif 41467_2019_13626_Article_IEq88.gif 41467_2019_13626_Article_IEq89.gif 41467_2019_13626_Article_IEq90.gif Similarly to reference tracking, rejection of disturbances should be independent of the time when they are introduced in the system. To test this, we characterized the controller response to a step change in the concentrations of  and  as disturbances. We started the reaction with ,  and  concentrations each set to 0.2 nM, and after 4 h of incubation, additional  and  were added (see Methods) (Fig. ). For the closed-loop case, instead of ,  was added in the same amounts (Fig. ). The output was changed by less than ~1.1-fold in the presence of the disturbances only in the closed-loop case, as expected based on our understanding of the controller compared to ~2.7-fold change in the open-loop case (Fig. ). It should be noted that cases where the disturbances were added after 4 h of the reaction (Fig. ), a lower deGFP expression results, due to the limited amount of  and  compared to when the disturbances were added at the beginning of the reaction (Fig. ) for the same concentration of ,  and . We also tested the controller’s response for a wide range of disturbances when different initial concentrations of DNA were used, and the disturbance was added in different amounts (see Supplementary Figs.  and ). In each case, we found a similar robust controller response in the closed-loop settings. Moreover, the open-loop analytical expression (Fig. ) suggested that the open-loop controller cannot suppress the disturbances independently of the absolute value of the output. We, therefore, tested the open-loop controller operation at a lower initial  value to produce an output response that is much lower than the closed-loop response shown in Fig.  while adding the same amount of disturbance in  and . We observed that the open-loop output level was increased by ~4-fold with the increase in DNA concentration and thus further validating the mathematical model of the controller (see Supplementary Fig. ). 41467_2019_13626_Article_IEq91.gif 41467_2019_13626_Article_IEq92.gif 41467_2019_13626_Article_IEq93.gif Closed-loop controller enables robustness to the global perturbation. 41467_2019_13626_Article_IEq94.gif 41467_2019_13626_Article_IEq95.gif 41467_2019_13626_Article_IEq96.gif 41467_2019_13626_Article_IEq97.gif 41467_2019_13626_Article_IEq98.gif 41467_2019_13626_Article_IEq99.gif ,  Measured response of the controller at three different external constant change in the reaction temperatures for the  open-loop ( and  were both 0.1 nM) and  closed-loop ( and  were both 1 nM each) cases while initial  was 0.1 nM. The error bars are shown in the shaded region and were determined using the standard error of the mean of three or more repeats. ,  Summary of the normalized deGFP slopes of the controller at 8 h for the  open-loop and  closed-loop operations. Error bars are from the SEM of at least three repeats. To disable the feedback in the open-loop case,  was replaced by , which expresses a protein that cannot sequester with . The responses shown in ,  were normalized with respect to the deGFP slope value recorded at 29 °C. Plate readers were calibrated at 29 °C, 33 °C, and 37 °C separately to a standard curve of GFP to ensure fluorescence variation reflects protein concentration variation (see Supplementary Fig. ). Before calculating deGFP slopes, measured deGFP responses were smoothed-out using the  smoothing method in MATLAB. Source data are provided as a Source Data file. Finally, we tested the operation of the controller subject to a global perturbation, such as a variation in a specific environmental condition that potentially affects several parameters simultaneously. One of such most natural global perturbations is variation in temperature. We, therefore, carried an experiment where the controller response was recorded at three different temperatures (29 °C, 33 °C, and 37 °C) in the open and closed-loop configurations (Fig. ; Supplementary Fig. ). To obtain similar output levels in the open-loop case as in the closed-loop case, different initial values of  (same as  and  for open-loop and closed-loop cases, respectively) were used while keeping the same input  values. We found that our controller is strikingly capable of suppressing the global disturbance caused by the change in the reaction temperature: while the open-loop system leads to a ~7-fold change in response, the closed-loop system only has a ~1.2-fold change (Fig. , d). Similar results were observed irrespective of the absolute value of the open-loop controller’s output (Supplementary Fig. ), and at a different initial concentration of the input  (Supplementary Fig. ). These results suggest that our closed-loop controller might lead to improved robustness of in vitro biomolecular processes with respect to changes in temperature. In this work, we constructed a synthetic biomolecular integral controller circuit for effective and robust control of the protein production rate of an output gene. We demonstrated that in the closed-loop configuration, the output followed the input signal linearly over a wide range of conditions, even under step changes in input. By harnessing the natural interaction between the  and the anti- factor a strong sequestration reaction is realized that allowed an effective computation of the error between the reference and the output signal. This error signal is then integrated mathematically. Because of this, and as predicted by theory, the closed-loop controller suppresses the disturbances’ effect on the output, which were introduced in the biochemical species as a local disturbance or in the reaction environment as a global disturbance. In contrast, the open-loop controller is unable to suppress the disturbances, as noticed by the large variations of the output signal. This illustrates the advantage of closed-loop architectures, where an error computation is employed. Mathematical models play an important role in understanding complex synthetic networks. They provide insight into the operation of networks, and serve to guide experimentation. Here, we developed an ODE model for the integral controller that quantitatively explains the transient as well as the steady-state behavior of all the species involved in the system. We were able to obtain an effective model parameterization, by isolating parameters for each set of experimental data before finding their optimum values to achieve the best fit. Even though the presented model is a coarse-grained mechanistic model, it enabled us to explain the measured response of the controller, and can also predict dynamic trajectories for a wide range of operating conditions accurately. Based on the extracted parameter values, we derived a simplified version of the original model that is as effective as the original model and can be used for further theoretical analysis in order to gain deeper insight into the operation of the controller. In this work, we assumed that the TXTL reactions have an unlimited source of energy for the first 8 h in the range of plasmid concentrations used. This allowed us to ignore the depletion of energy resources while building the ODE model of the controller. After 8 h, we observed a reduction in deGFP expression, suggesting a decrease of transcription and translation rates consistent with the depletion of energy resources and biochemical changes such as pH drop. To account for the resource competition and depletion in the measured response, we were able to modify the ODE model in a such a manner that it was able to follow the experimental data beyond 8 h (see Supplementary Note ). Future work could incorporate further validation and extension of this model. For example, any cell-free reaction kit has a lifetime as it accumulates byproducts and consumes the nutrients (ribonucleosides and amino acids) even in the absence of any DNA. Because of this reason, we had to add the DNA before 6 h after the beginning of the reaction. Moreover, because the controller was implemented in a TXTL reaction platform at the scale of a few microliters, a deterministic model was used while ignoring the biological noise. For in vivo applications, it may be desirable to extend the deterministic model to a stochastic model to consider intrinsic biological noise. 41467_2019_13626_Article_IEq100.gif 41467_2019_13626_Article_IEq101.gif We used a molecular sequestration reaction to implement the error computation. Previous models used similar approaches to realize closed-loop controllers for reference tracking and disturbance rejection. In particular, recent experimental work demonstrated new capabilities of the closed-loop controller. Our design, while related to those in, has advantageous features which allowed us to carry out experimentation, much beyond what was previously possible, with variations in parameters and conditions. In addition, our results are unique in the sense that we have a quantitatively well-characterized controller that is constructed in all  TXTL system, where biological noise is negligible compared to in vivo implementations. In the latter, biological noise plays a non-negligible role in governing the system dynamics. Because of this, we cannot only precisely regulate gene expression rate, but can also accurately predict the dynamic response of the integral controller. Our controller design, which uses a gene network, can in principle also be applied to regulate any other genes of interest, such as those involved in controlling metabolic rates, a task which might not be feasible using a post-transcriptional based controller. We also demonstrate disturbance rejection capabilities of our controller when a constant or a step disturbance is added to DNA concentration ( and ); disturbances in DNA concentration are realistic because they typically arise in in vivo or in vitro genetic networks. Such experiments are not feasible using an in vivo reaction platform, thereby limiting the usage of the controller in rapid prototyping and implementation. 41467_2019_13626_Article_IEq102.gif Notably, for the current architecture, disturbance rejection is only possible when perturbations do not directly influence the parameters involved in governing the production rate of the reporter protein and the protein  is expressed at values that are below or of order  (shown in Fig. ). These parameters are the concentration of  and  genes, and the association () and dissociation () rates. We have shown the controller capability to minimize the effect of the disturbance added on the concentration of  and . To demonstrate robustness with respect to the transcriptional activation rates, we have conducted  experiments in which we modified  and  parameters from their nominal values and observed a small variation in the closed-loop output compared to a significant variation in the open-loop output (Supplementary Figs.  and ). While adding disturbances in the biochemical species or in the reaction parameters, we observed that the steady-state output value was perturbed by a non-negligible amount (>10%) at 8 h. This may be due to the limited effectiveness of the error computation. In our design, effective error computation requires that  sequesters  rapidly compared to the other reactions which use , namely the two transcriptional activation reactions. If the consumption of  is not dominated by the sequestration reaction compared to the retroactivity effect due to the transcriptional activation reactions, the controller’s performance is degraded, and the output has a limited capacity to track the reference signal accurately on the face of disturbances. We, therefore, hypothesized that in the current controller, the effect of the disturbance on the output can be reduced but not completely rejected because of the slight ineffectiveness of error computation, which is due to the limited sequestration reaction rate constant. To test this, we have conducted  experiments in which we increased the molecular sequestration rate while keeping the nominal transcriptional activation rate fixed and found that the variation in the steady-state output was reduced from 10% to <0.5% at 12 h (Supplementary Fig. ). Alternatively, when we increased the transcription activation rate while keeping the nominal sequestration rate fixed, the steady-state output was increased from 10% to ~30% as a function of  and  (Supplementary Fig. ). 41467_2019_13626_Article_IEq103.gif 41467_2019_13626_Article_IEq104.gif It is important to note that our controller uses the expression of gene  as a read-out signal. Therefore, in order to ensure that the plant signal is recorded accurately through , the concentration of gene  must be the same as that of gene 
 and the same promoters must be used on  and  genes so that the association and dissociation rates for the transactional activator are the same. These conditions ensure that at any time during the reaction, . To achieve this operating condition in vivo,  and  could be expressed on the same operon, controlled by a single promoter. Finally, in this work, we demonstrated that the closed-loop controller can robustly control the single gene expression rate of the deGFP fluorescent reporter protein taken as a model process to be controlled. However, we anticipate that the controller design could be extended to tightly regulate multiple genes that encode other biologically relevant proteins simultaneously or could be employed within a complex network system where multiple processes required tight regulation to improve robustness and performance of the network. Molecular controllers capable of robust gene regulation are needed in synthetic biology in order to implement more complex circuit networks. The well-characterized and rationally implemented synthetic integral feedback controller we presented here is capable of addressing these challenges to advance biological engineering, and could lead to the development of powerful, synthetic network systems capable of achieving complexity similar to that found at the cellular level, to develop cell-free applications such as calibrated biomanufacturing or programming synthetic cells for specific tasks. Mathematical modeling and parameter estimation The simulated response of the controller was determined by numerically integrating ODE models (Fig. ) using the MATLAB ode23s solver unless otherwise specified. Initial conditions for each molecular species are described in the figure captions, and the values of reaction parameters are shown in Table . For the cases where there is a step change in the DNA concentration over the course of the reaction, similar settings were used to determine the model response numerically. 41467_2019_13626_Article_IEq105.gif 41467_2019_13626_Article_IEq106.gif For parameter estimation, first we found initial guesses of parameter values that qualitatively agreed with the measured open-loop response. We then randomly sampled a set of input parameters from a uniform distribution within a bounded interval (upper and lower bounds of 15% each) centered around the initial guess values. This input set of parameters was then optimized to minimize the error between the model and measured open-loop responses for all five trajectories (shown in Fig. ). To find the best fit, the least squares error between the model and the measured response was minimized using the MATLAB fmincon function. During the fitting, each input parameter was allowed to vary from 0.1 to 10 times with respect to the input value. Further constraints were placed on the parameters so that they lie within a feasible biological range. For example, the activated transcriptional rate must be several orders of magnitude larger than the basal expression (» and ») and the transcriptional rates of the  gene and activated  and  genes should be in the same order ( ≈  ≈ ) (see Supplementary Table ). Because in the open-loop case, a modified version of  gene (denoted as ) is expressed from the promoter  and cannot sequester with , parameters , , 
, , , and  were set to zero. Once we found the optimum set of parameter values that provided the best fit for the open-loop response, these parameter values were then fixed during fitting all five trajectories of the closed-loop response (shown in Fig. ) while varying only 
, 
, , and . This resulted in a set of 16 parameters that fit both open and closed-loop responses (Fig. , d, respectively). The fitting process was repeated 1000 times, which gave a range for the 16 parameters (Supplementary Fig. ) with 95% confidence interval. The cell-free expression system used in this work is myTXTL from Arbor Biosciences. TXTL reactions were assembled using the Labcyte Echo 550 liquid handler, to volumes of 2 µl in a 96-well V-bottom plate (Corning Costar 3357 with caps Costar 3080) and incubated at 29 °C. Plasmids were constructed using standard cloning techniques. P and P are the strongest  and  promoters reported in TXTL, respectively. Each plasmid contains the untranslated region and RBS named UTR1, originally from the promoter 14 of the T7 phage genome, and either the  promoter P or the  promoter P. UTR1 uses the strongest reported RBS in TXTL. All DNA constructs with terminators use the strong synthetic terminator T500. All the sequences of the plasmids and DNA parts (promoters and transcription terminators) are reported in the DNA sequences Supplementary File. The  gene is 348 bp long, while  gene is 294 bp long. mSA is a soluble protein, like FlgM. The mSA protein does not have a regulatory effect on gene expression in these reactions and is used as a control for FlgM. For experiments with step changes in the concentration of DNA, the TXTL reactions were assembled in the same manner, using the Labcyte Echo 550, and incubated in a plate reader at 29 °C. Reactions were then taken out of the plate reader, and the additional DNA was added to the reaction using the Labcyte Echo 550. The well plate was then immediately returned to the plate reader. The total time that the well plate was out of the reader and at room temperature was less than two minutes. The step-change of DNA added to the reactions diluted the TXTL reaction by <5%. TXTL time-course fluorescence measurements Fluorescence kinetics were performed using the reporter protein deGFP, a truncated version of eGFP that is more translatable in the TXTL system (25.4 kDa, 1 mg/mL = 39.38 µM). Measurements were carried out on Synergy H1 and Neo2 (Biotek Instruments) plate readers, using an excitation of 485 nm and emission of 525 nm, measuring every 3 min. To quantify the concentration of deGFP on the plate readers, a standard curve of intensity vs. deGFP concentration was made using recombinant eGFP (Cell Biolabs). All reactions were performed in at least triplicate. Nature Research Reporting Summary Further information on research design is available in the  linked to this article. 41467_2019_13626_MOESM1_ESM.pdf 41467_2019_13626_MOESM2_ESM.pdf.